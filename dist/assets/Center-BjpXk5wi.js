import{D as pt,G as ft,_ as vt,h as yt,y as It,o as j,c as U,i as st,u as Y,s as gt}from"./index-swJZttoy.js";import{u as St}from"./cockpit-5ewkRGcC.js";const at=""+new URL("left-GX73T5Er.png",import.meta.url).href,nt=""+new URL("right-DcvQmysi.png",import.meta.url).href;var ot={exports:{}};(function(q,N){(function(R,w){q.exports=w()})(pt,function(){var R=function(d,a){return R=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,i){t.__proto__=i}||function(t,i){for(var e in i)Object.prototype.hasOwnProperty.call(i,e)&&(t[e]=i[e])},R(d,a)};function w(d,a){if(typeof a!="function"&&a!==null)throw new TypeError("Class extends value "+String(a)+" is not a constructor or null");function t(){this.constructor=d}R(d,a),d.prototype=a===null?Object.create(a):(t.prototype=a.prototype,new t)}var L=function(){return L=Object.assign||function(d){for(var a,t=1,i=arguments.length;t<i;t++)for(var e in a=arguments[t])Object.prototype.hasOwnProperty.call(a,e)&&(d[e]=a[e]);return d},L.apply(this,arguments)};function l(d,a){var t=typeof Symbol=="function"&&d[Symbol.iterator];if(!t)return d;var i,e,s=t.call(d),n=[];try{for(;(a===void 0||a-- >0)&&!(i=s.next()).done;)n.push(i.value)}catch(r){e={error:r}}finally{try{i&&!i.done&&(t=s.return)&&t.call(s)}finally{if(e)throw e.error}}return n}function X(d,a,t){for(var i=!1,e=t.length,s=0,n=e-1;s<e;n=s++){var r=t[s][0],h=t[s][1],o=t[n][0],p=t[n][1];h>a!=p>a&&d<(o-r)*(a-h)/(p-h)+r&&(i=!i)}return i}typeof SuppressedError=="function"&&SuppressedError;var c,_=function(d,a){this.label="",this.coor=[],this.active=!1,this.creating=!1,this.dragging=!1,this.uuid=function(){for(var t=[],i="0123456789abcdef",e=0;e<36;e++){var s=Math.floor(16*Math.random());t[e]=i.slice(s,s+1)}t[14]="4";var n=3&t[19]|8;return t[19]=i.slice(n,n+1),t[8]=t[13]=t[18]=t[23]="-",t.join("")}(),this.index=a,Object.assign(this,d)},T=function(d){function a(t,i){var e=d.call(this,t,i)||this;return e.type=1,e}return w(a,d),Object.defineProperty(a.prototype,"ctrlsData",{get:function(){var t=l(this.coor,2),i=l(t[0],2),e=i[0],s=i[1],n=l(t[1],2),r=n[0],h=n[1];return[[e,s],[e+(r-e)/2,s],[r,s],[r,s+(h-s)/2],[r,h],[e+(r-e)/2,h],[e,h],[e,s+(h-s)/2]]},enumerable:!1,configurable:!0}),a}(_),A=function(d){function a(t,i){var e=d.call(this,t,i)||this;return e.type=2,e}return w(a,d),Object.defineProperty(a.prototype,"ctrlsData",{get:function(){return this.coor.length>2?this.coor:[]},enumerable:!1,configurable:!0}),a}(_),B=function(d){function a(t,i){var e=d.call(this,t,i)||this;return e.type=3,e}return w(a,d),a}(_),rt=function(){function d(){this._eventTree={}}return d.prototype.on=function(a,t){var i=this._eventTree[a];Array.isArray(i)?i.push(t):this._eventTree[a]=[t]},d.prototype.emit=function(a){for(var t=[],i=1;i<arguments.length;i++)t[i-1]=arguments[i];var e=this._eventTree[a];Array.isArray(e)&&e.forEach(function(s){return s.apply(void 0,function(n,r,h){if(arguments.length===2)for(var o,p=0,f=r.length;p<f;p++)!o&&p in r||(o||(o=Array.prototype.slice.call(r,0,p)),o[p]=r[p]);return n.concat(o||Array.prototype.slice.call(r))}([],l(t),!1))})},d.prototype.off=function(a,t){var i=this._eventTree[a],e=i.find(function(s){return s===t});Array.isArray(i)&&e&&i.splice(e,1)},d}(),Z=function(d){function a(t,i){var e=d.call(this,t,i)||this;return e.type=4,e}return w(a,d),Object.defineProperty(a.prototype,"ctrlsData",{get:function(){return this.coor.length>1?this.coor:[]},enumerable:!1,configurable:!0}),a}(_),z=function(d){function a(t,i){var e=d.call(this,t,i)||this;return e.type=5,e.radius=0,e.radius=t.radius||e.radius,e}return w(a,d),Object.defineProperty(a.prototype,"ctrlsData",{get:function(){var t=l(this.coor,2),i=t[0],e=t[1];return[[i,e-this.radius],[i+this.radius,e],[i,e+this.radius],[i-this.radius,e]]},enumerable:!1,configurable:!0}),a}(_),ht="2.21.1";(function(d){d[d.None=0]="None",d[d.Rect=1]="Rect",d[d.Polygon=2]="Polygon",d[d.Dot=3]="Dot",d[d.Line=4]="Line",d[d.Circle=5]="Circle"})(c||(c={}));var ct=function(d){function a(t,i){var e=d.call(this)||this;e.version=ht,e.lock=!1,e.readonly=!1,e.MIN_WIDTH=10,e.MIN_HEIGHT=10,e.MIN_RADIUS=5,e.strokeStyle="#0f0",e.fillStyle="rgba(0, 0, 255,0.1)",e.lineWidth=1,e.activeStrokeStyle="#f00",e.activeFillStyle="rgba(255, 0, 0,0.1)",e.ctrlStrokeStyle="#000",e.ctrlFillStyle="#fff",e.ctrlRadius=3,e.hideLabel=!1,e.labelFillStyle="#fff",e.labelFont="10px sans-serif",e.textFillStyle="#000",e.labelMaxLen=10,e.WIDTH=0,e.HEIGHT=0,e.dataset=[],e.remmberOrigin=[0,0],e.createType=c.None,e.ctrlIndex=-1,e.image=new Image,e.IMAGE_WIDTH=0,e.IMAGE_ORIGIN_HEIGHT=0,e.IMAGE_HEIGHT=0,e.originX=0,e.originY=0,e.scaleStep=0,e.scrollZoom=!0,e.dblTouch=300,e.dblTouchStore=0,e.alpha=!0,e.focusMode=!1,e.scaleTouchStore=0,e.isTouch2=!1,e.isMobile=navigator.userAgent.includes("Mobile"),e.labelUp=!1,e.ctrlKey=!1,e.handleLoad=e.handleLoad.bind(e),e.handleContextmenu=e.handleContextmenu.bind(e),e.handleMousewheel=e.handleMousewheel.bind(e),e.handleMouseDown=e.handleMouseDown.bind(e),e.handleMouseMove=e.handleMouseMove.bind(e),e.handleMouseUp=e.handleMouseUp.bind(e),e.handleDblclick=e.handleDblclick.bind(e),e.handleKeyup=e.handleKeyup.bind(e),e.handleKeydown=e.handleKeydown.bind(e);var s=typeof t=="string"?document.querySelector(t):t;return s instanceof HTMLCanvasElement?(e.canvas=s,e.offScreen=document.createElement("canvas"),e.initSetting(),e.initEvents(),i&&e.setImage(i)):console.warn("HTMLCanvasElement is required!"),e}return w(a,d),Object.defineProperty(a.prototype,"activeShape",{get:function(){return this.dataset.find(function(t){return t.active})||{}},enumerable:!1,configurable:!0}),Object.defineProperty(a.prototype,"scale",{get:function(){return this.IMAGE_ORIGIN_WIDTH&&this.IMAGE_WIDTH?this.IMAGE_WIDTH/this.IMAGE_ORIGIN_WIDTH:1},enumerable:!1,configurable:!0}),Object.defineProperty(a.prototype,"imageMin",{get:function(){return Math.min(this.IMAGE_WIDTH,this.IMAGE_HEIGHT)},enumerable:!1,configurable:!0}),Object.defineProperty(a.prototype,"imageOriginMax",{get:function(){return Math.max(this.IMAGE_ORIGIN_WIDTH,this.IMAGE_ORIGIN_HEIGHT)},enumerable:!1,configurable:!0}),a.prototype.mergeEvent=function(t){var i=0,e=0,s=0,n=0;if(this.isMobile){var r=t.touches[0],h=r.clientX,o=r.clientY,p=t.target.getBoundingClientRect(),f=p.left,u=p.top;if(i=Math.round(h-f),e=Math.round(o-u),t.touches.length===2){var v=t.touches[1]||{},g=v.clientX,b=g===void 0?0:g,I=v.clientY,S=I===void 0?0:I;s=Math.round(Math.abs((b-h)/2+h)-f),n=Math.round(Math.abs((S-o)/2+o)-u)}}else i=t.offsetX,e=t.offsetY;return L(L({},t),{mouseX:i,mouseY:e,mouseCX:s,mouseCY:n})},a.prototype.handleLoad=function(){this.emit("load",this.image.src),this.IMAGE_ORIGIN_WIDTH=this.IMAGE_WIDTH=this.image.width,this.IMAGE_ORIGIN_HEIGHT=this.IMAGE_HEIGHT=this.image.height,this.fitZoom()},a.prototype.handleContextmenu=function(t){t.preventDefault(),this.evt=t,this.lock},a.prototype.handleMousewheel=function(t){if(t.stopPropagation(),this.evt=t,!this.lock&&this.scrollZoom){var i=this.mergeEvent(t),e=i.mouseX,s=i.mouseY;this.mouse=[e,s],this.setScale(t.deltaY<0,!0)}},a.prototype.handleMouseDown=function(t){var i=this;if(t.stopPropagation(),this.evt=t,!this.lock){var e=this.mergeEvent(t),s=e.mouseX,n=e.mouseY,r=e.mouseCX,h=e.mouseCY,o=Math.round(s/this.scale),p=Math.round(n/this.scale);if(this.mouse=this.isMobile&&t.touches.length===2?[r,h]:[s,n],this.remmberOrigin=[s-this.originX,n-this.originY],!this.isMobile&&t.buttons===1||this.isMobile&&t.touches.length===1){var f=this.activeShape.ctrlsData||[];if(this.ctrlIndex=f.findIndex(function(M){return i.isPointInCircle(i.mouse,M,i.ctrlRadius)}),this.ctrlIndex>-1&&!this.readonly){var u=l(f[this.ctrlIndex],2),v=u[0],g=u[1];this.activeShape.type===c.Polygon&&this.activeShape.coor.length>2&&this.ctrlIndex===0&&this.handleDblclick(t),this.remmber=[[o-v,p-g]]}else if(this.isInBackground(t)){if(this.activeShape.creating&&!this.readonly){if([c.Polygon,c.Line].includes(this.activeShape.type)){var b=l(this.activeShape.coor[this.activeShape.coor.length-1],2),I=b[0],S=b[1];if(I!==o&&S!==p){var E=Math.round(o-this.originX/this.scale),k=Math.round(p-this.originY/this.scale);this.activeShape.coor.push([E,k])}}}else if(this.createType===c.None||this.readonly||this.ctrlKey){var G=l(this.hitOnShape(this.mouse),2),m=G[0],W=G[1];if(m>-1){if(W.dragging=!0,this.dataset.forEach(function(M,x){return M.active=x===m}),this.dataset.splice(m,1),this.dataset.push(W),!this.readonly)if(this.remmber=[],[c.Dot,c.Circle].includes(W.type)){var D=l(W.coor,2);I=D[0],S=D[1],this.remmber=[[o-I,p-S]]}else W.coor.forEach(function(M){i.remmber.push([o-M[0],p-M[1]])});this.emit("select",W)}else this.activeShape.active=!1,this.dataset.sort(function(M,x){return M.index-x.index}),this.emit("select",null)}else{var y=void 0,H=[E=Math.round(o-this.originX/this.scale),k=Math.round(p-this.originY/this.scale)];switch(this.createType){case c.Rect:(y=new T({coor:[H,H]},this.dataset.length)).creating=!0;break;case c.Polygon:(y=new A({coor:[H]},this.dataset.length)).creating=!0;break;case c.Dot:y=new B({coor:H},this.dataset.length),this.emit("add",y);break;case c.Line:(y=new Z({coor:[H]},this.dataset.length)).creating=!0;break;case c.Circle:(y=new z({coor:H},this.dataset.length)).creating=!0}this.dataset.forEach(function(M){M.active=!1}),y.active=!0,this.dataset.push(y)}this.update()}}}},a.prototype.handleMouseMove=function(t){if(t.stopPropagation(),this.evt=t,!this.lock){var i=this.mergeEvent(t),e=i.mouseX,s=i.mouseY,n=i.mouseCX,r=i.mouseCY,h=Math.round(e/this.scale),o=Math.round(s/this.scale);if(this.mouse=this.isMobile&&t.touches.length===2?[n,r]:[e,s],(!this.isMobile&&t.buttons===1||this.isMobile&&t.touches.length===1)&&this.activeShape.type){if(this.ctrlIndex>-1&&this.remmber.length&&(this.isInBackground(t)||this.activeShape.type===c.Circle)){var p=l(this.remmber,1),f=l(p[0],2),u=f[0],v=f[1];if(this.activeShape.type===c.Rect){var g=l(this.activeShape.coor,2),b=l(g[0],2),I=b[0],S=b[1],E=l(g[1],2),k=E[0],G=E[1],m=[];switch(this.ctrlIndex){case 0:m=[[h-u,o-v],[k,G]];break;case 1:m=[[I,o-v],[k,G]];break;case 2:m=[[I,o-v],[h-u,G]];break;case 3:m=[[I,S],[h-u,G]];break;case 4:m=[[I,S],[h-u,o-v]];break;case 5:m=[[I,S],[k,o-v]];break;case 6:m=[[h-u,S],[k,o-v]];break;case 7:m=[[h-u,S],[k,G]]}var W=l(m,2),D=l(W[0],2),y=D[0],H=D[1],M=l(W[1],2),x=M[0],C=M[1];(y<0||x<0||H<0||C<0||x>this.IMAGE_ORIGIN_WIDTH||C>this.IMAGE_ORIGIN_HEIGHT)&&(y<0&&(y=0),x<0&&(x=0),H<0&&(H=0),C<0&&(C=0),x>this.IMAGE_ORIGIN_WIDTH&&(x=this.IMAGE_ORIGIN_WIDTH),C>this.IMAGE_ORIGIN_HEIGHT&&(C=this.IMAGE_ORIGIN_HEIGHT)),x-y>=this.MIN_WIDTH&&C-H>=this.MIN_HEIGHT?this.activeShape.coor=[[y,H],[x,C]]:this.emit("warn","Width cannot be less than ".concat(this.MIN_WIDTH,",Height cannot be less than").concat(this.MIN_HEIGHT,"。"))}else if([c.Polygon,c.Line].includes(this.activeShape.type)){var F=[Math.round(h-this.originX/this.scale),Math.round(o-this.originY/this.scale)];this.activeShape.coor.splice(this.ctrlIndex,1,F)}else if(this.activeShape.type===c.Circle){var P=Math.round(h-this.originX/this.scale)-this.activeShape.coor[0];P>=this.MIN_RADIUS&&(this.activeShape.radius=P)}}else if(this.activeShape.dragging&&!this.readonly){m=[];var O=!0,J=this.IMAGE_ORIGIN_WIDTH||this.WIDTH,V=this.IMAGE_ORIGIN_HEIGHT||this.HEIGHT;if([c.Dot,c.Circle].includes(this.activeShape.type)){var Q=l(this.remmber[0],2),lt=Q[0];v=o-Q[1],((u=h-lt)<0||u>J||v<0||v>V)&&(O=!1),m=[u,v]}else for(var K=0;K<this.activeShape.coor.length;K++){var $=this.remmber[K];u=h-$[0],v=o-$[1],(u<0||u>J||v<0||v>V)&&(O=!1),m.push([u,v])}O&&(this.activeShape.coor=m)}else if(this.activeShape.creating&&this.isInBackground(t)){if(u=Math.round(h-this.originX/this.scale),v=Math.round(o-this.originY/this.scale),this.activeShape.type===c.Rect)this.activeShape.coor.splice(1,1,[u,v]);else if(this.activeShape.type===c.Circle){var tt=l(this.activeShape.coor,2),ut=(I=tt[0],S=tt[1],Math.sqrt(Math.pow(I-u,2)+Math.pow(S-v,2)));this.activeShape.radius=ut}}this.update()}else if([c.Polygon,c.Line].includes(this.activeShape.type)&&this.activeShape.creating)this.update();else if(!this.isMobile&&t.buttons===2&&t.which===3||this.isMobile&&t.touches.length===1&&!this.isTouch2)this.originX=Math.round(e-this.remmberOrigin[0]),this.originY=Math.round(s-this.remmberOrigin[1]),this.update();else if(this.isMobile&&t.touches.length===2){this.isTouch2=!0;var et=t.touches[0],it=t.touches[1],dt=this.scaleTouchStore;this.scaleTouchStore=Math.abs((it.clientX-et.clientX)*(it.clientY-et.clientY)),this.setScale(this.scaleTouchStore>dt,!0)}}},a.prototype.handleMouseUp=function(t){if(t.stopPropagation(),this.evt=t,!this.lock){if(this.isMobile){if(t.touches.length===0&&(this.isTouch2=!1),Date.now()-this.dblTouchStore<this.dblTouch)return void this.handleDblclick(t);this.dblTouchStore=Date.now()}if(this.remmber=[],this.activeShape.type!==c.None&&!this.ctrlKey&&(this.activeShape.dragging=!1,this.activeShape.creating)){if(this.activeShape.type===c.Rect){var i=l(this.activeShape.coor,2),e=l(i[0],2),s=e[0],n=e[1],r=l(i[1],2),h=r[0],o=r[1];Math.abs(s-h)<this.MIN_WIDTH||Math.abs(n-o)<this.MIN_HEIGHT?(this.dataset.pop(),this.emit("warn","Width cannot be less than ".concat(this.MIN_WIDTH,",Height cannot be less than ").concat(this.MIN_HEIGHT))):(this.activeShape.coor=[[Math.min(s,h),Math.min(n,o)],[Math.max(s,h),Math.max(n,o)]],this.activeShape.creating=!1,this.emit("add",this.activeShape))}else this.activeShape.type===c.Circle&&(this.activeShape.radius<this.MIN_RADIUS?(this.dataset.pop(),this.emit("warn","Radius cannot be less than ".concat(this.MIN_WIDTH))):(this.activeShape.creating=!1,this.emit("add",this.activeShape)));this.update()}}},a.prototype.handleDblclick=function(t){if(t.stopPropagation(),this.evt=t,!this.lock&&[c.Polygon,c.Line].includes(this.activeShape.type)){var i=this.activeShape.type===c.Polygon&&this.activeShape.coor.length>2,e=this.activeShape.type===c.Line&&this.activeShape.coor.length>1;(i||e)&&(this.emit("add",this.activeShape),this.activeShape.creating=!1,this.update())}},a.prototype.handleKeydown=function(t){t.key==="Control"&&(this.ctrlKey=!0)},a.prototype.handleKeyup=function(t){t.key==="Control"&&(this.ctrlKey=!1),this.evt=t,this.lock||document.activeElement!==document.body||this.readonly||this.activeShape.type&&([c.Polygon,c.Line].includes(this.activeShape.type)&&t.key==="Escape"?(this.activeShape.coor.length>1&&this.activeShape.creating?this.activeShape.coor.pop():this.deleteByIndex(this.activeShape.index),this.update()):t.key==="Backspace"&&this.deleteByIndex(this.activeShape.index))},a.prototype.initSetting=function(){var t=window.devicePixelRatio||1;this.canvas.style.userSelect="none",this.ctx=this.ctx||this.canvas.getContext("2d",{alpha:this.alpha}),this.WIDTH=Math.round(this.canvas.clientWidth),this.HEIGHT=Math.round(this.canvas.clientHeight),this.canvas.width=this.WIDTH*t,this.canvas.height=this.HEIGHT*t,this.canvas.style.width=this.WIDTH+"px",this.canvas.style.height=this.HEIGHT+"px",this.offScreen.width=this.WIDTH,this.offScreen.height=this.HEIGHT,this.offScreenCtx=this.offScreenCtx||this.offScreen.getContext("2d",{willReadFrequently:!0}),this.ctx.scale(t,t)},a.prototype.initEvents=function(){this.image.addEventListener("load",this.handleLoad),this.canvas.addEventListener("touchstart",this.handleMouseDown),this.canvas.addEventListener("touchmove",this.handleMouseMove),this.canvas.addEventListener("touchend",this.handleMouseUp),this.canvas.addEventListener("contextmenu",this.handleContextmenu),this.canvas.addEventListener("mousewheel",this.handleMousewheel),this.canvas.addEventListener("mousedown",this.handleMouseDown),this.canvas.addEventListener("mousemove",this.handleMouseMove),this.canvas.addEventListener("mouseup",this.handleMouseUp),this.canvas.addEventListener("dblclick",this.handleDblclick),document.body.addEventListener("keydown",this.handleKeydown,!0),document.body.addEventListener("keyup",this.handleKeyup,!0)},a.prototype.setImage=function(t){this.image.src=t},a.prototype.setData=function(t){var i=this;setTimeout(function(){var e=[];t.forEach(function(s,n){if(Object.prototype.toString.call(s).includes("Object")){var r=void 0;switch(s.type){case c.Rect:r=new T(s,n);break;case c.Polygon:r=new A(s,n);break;case c.Dot:r=new B(s,n);break;case c.Line:r=new Z(s,n);break;case c.Circle:r=new z(s,n);break;default:console.warn("Invalid shape",s)}[c.Rect,c.Polygon,c.Dot,c.Line,c.Circle].includes(s.type)&&e.push(r)}else console.warn("Shape must be an enumerable Object.",s)}),i.dataset=e,i.update()})},a.prototype.hitOnShape=function(t){for(var i,e=-1,s=this.dataset.length-1;s>-1;s--){var n=this.dataset[s];if(n.type===c.Dot&&this.isPointInCircle(t,n.coor,this.ctrlRadius)||n.type===c.Circle&&this.isPointInCircle(t,n.coor,n.radius*this.scale)||n.type===c.Rect&&this.isPointInRect(t,n.coor)||n.type===c.Polygon&&this.isPointInPolygon(t,n.coor)||n.type===c.Line&&this.isPointInLine(t,n.coor)){if(this.focusMode&&!n.active)continue;e=s,i=n;break}}return[e,i]},a.prototype.isInBackground=function(t){var i=this.mergeEvent(t),e=i.mouseX,s=i.mouseY;return e>=this.originX&&s>=this.originY&&e<=this.originX+this.IMAGE_ORIGIN_WIDTH*this.scale&&s<=this.originY+this.IMAGE_ORIGIN_HEIGHT*this.scale},a.prototype.isPointInRect=function(t,i){var e=this,s=l(t,2),n=s[0],r=s[1],h=l(i.map(function(b){return b.map(function(I){return I*e.scale})}),2),o=l(h[0],2),p=o[0],f=o[1],u=l(h[1],2),v=u[0],g=u[1];return p+this.originX<=n&&n<=v+this.originX&&f+this.originY<=r&&r<=g+this.originY},a.prototype.isPointInPolygon=function(t,i){var e=this;this.offScreenCtx.save(),this.offScreenCtx.clearRect(0,0,this.WIDTH,this.HEIGHT),this.offScreenCtx.translate(this.originX,this.originY),this.offScreenCtx.beginPath(),i.forEach(function(r,h){var o=l(r.map(function(u){return Math.round(u*e.scale)}),2),p=o[0],f=o[1];h===0?e.offScreenCtx.moveTo(p,f):e.offScreenCtx.lineTo(p,f)}),this.offScreenCtx.closePath(),this.offScreenCtx.fill();var s=this.offScreenCtx.getImageData(0,0,this.WIDTH,this.HEIGHT),n=(t[1]-1)*this.WIDTH*4+4*t[0];return this.offScreenCtx.restore(),s.data[n+3]!==0},a.prototype.isPointInCircle=function(t,i,e){var s=this,n=l(t,2),r=n[0],h=n[1],o=l(i.map(function(u){return u*s.scale}),2),p=o[0],f=o[1];return Math.sqrt(Math.pow(p+this.originX-r,2)+Math.pow(f+this.originY-h,2))<=e},a.prototype.isPointInLine=function(t,i){var e=this;this.offScreenCtx.save(),this.offScreenCtx.clearRect(0,0,this.WIDTH,this.HEIGHT),this.offScreenCtx.translate(this.originX,this.originY),this.offScreenCtx.lineWidth=5,this.offScreenCtx.beginPath(),i.forEach(function(r,h){var o=l(r.map(function(u){return Math.round(u*e.scale)}),2),p=o[0],f=o[1];h===0?e.offScreenCtx.moveTo(p,f):e.offScreenCtx.lineTo(p,f)}),this.offScreenCtx.stroke();var s=this.offScreenCtx.getImageData(0,0,this.WIDTH,this.HEIGHT),n=(t[1]-1)*this.WIDTH*4+4*t[0];return this.offScreenCtx.restore(),s.data[n+3]!==0},a.prototype.isNested=function(t,i){return function(e,s){if(e.type===1&&s.type===1){var n=l(e.coor,2),r=l(n[0],2),h=r[0],o=r[1],p=l(n[1],2),f=p[0],u=p[1],v=l(s.coor,2),g=l(v[0],2),b=g[0],I=g[1],S=l(v[1],2),E=S[0],k=S[1];return h<=b&&o<=I&&f>=E&&u>=k}if(e.type===1&&s.type===2){for(var G=l(e.coor,2),m=l(G[0],2),W=(h=m[0],o=m[1],l(G[1],2)),D=(f=W[0],u=W[1],s.coor),y=0;y<D.length;y++){var H=l(D[y],2),M=H[0],x=H[1];if(M<h||M>f||x<o||x>u)return!1}return!0}if(e.type===2&&s.type===1){for(D=s.coor,y=0;y<D.length;y++){var C=l(D[y],2);if(!X(M=C[0],x=C[1],e.coor))return!1}return!0}if(e.type===2&&s.type===2){var F=e.coor,P=s.coor;for(y=0;y<P.length;y++){var O=l(P[y],2);if(!X(M=O[0],x=O[1],F))return!1}return!0}}(t,i)},a.prototype.drawRect=function(t){var i=this;if(t.coor.length===2){var e=t.strokeStyle,s=t.fillStyle,n=t.active,r=t.creating,h=t.coor,o=t.lineWidth,p=l(h.map(function(k){return k.map(function(G){return Math.round(G*i.scale)})}),2),f=l(p[0],2),u=f[0],v=f[1],g=l(p[1],2),b=g[0],I=g[1];this.ctx.save(),this.ctx.lineWidth=o||this.lineWidth,this.ctx.fillStyle=s||this.fillStyle,this.ctx.strokeStyle=n||r?this.activeStrokeStyle:e||this.strokeStyle;var S=b-u,E=I-v;r||this.ctx.fillRect(u,v,S,E),this.ctx.strokeRect(u,v,S,E),this.ctx.restore(),this.drawLabel(h[0],t)}},a.prototype.drawPolygon=function(t){var i=this,e=t.strokeStyle,s=t.fillStyle,n=t.active,r=t.creating,h=t.coor,o=t.lineWidth;if(this.ctx.save(),this.ctx.lineJoin="round",this.ctx.lineWidth=o||this.lineWidth,this.ctx.fillStyle=s||this.fillStyle,this.ctx.strokeStyle=n||r?this.activeStrokeStyle:e||this.strokeStyle,this.ctx.beginPath(),h.forEach(function(v,g){var b=l(v.map(function(E){return Math.round(E*i.scale)}),2),I=b[0],S=b[1];g===0?i.ctx.moveTo(I,S):i.ctx.lineTo(I,S)}),r){var p=l(this.mouse||[],2),f=p[0],u=p[1];this.ctx.lineTo(f-this.originX,u-this.originY)}else h.length>2&&this.ctx.closePath();this.ctx.fill(),this.ctx.stroke(),this.ctx.restore(),this.drawLabel(h[0],t)},a.prototype.drawDot=function(t){var i=this,e=t.strokeStyle,s=t.fillStyle,n=t.active,r=t.coor,h=t.lineWidth,o=l(r.map(function(u){return u*i.scale}),2),p=o[0],f=o[1];this.ctx.save(),this.ctx.lineWidth=h||this.lineWidth,this.ctx.fillStyle=s||this.ctrlFillStyle,this.ctx.strokeStyle=n?this.activeStrokeStyle:e||this.strokeStyle,this.ctx.beginPath(),this.ctx.arc(p,f,this.ctrlRadius,0,2*Math.PI,!0),this.ctx.fill(),this.ctx.arc(p,f,this.ctrlRadius,0,2*Math.PI,!0),this.ctx.stroke(),this.ctx.restore(),this.drawLabel(r,t)},a.prototype.drawCirle=function(t){var i=this,e=t.strokeStyle,s=t.fillStyle,n=t.active,r=t.coor;t.label;var h=t.creating,o=t.radius,p=t.ctrlsData,f=t.lineWidth,u=l(r.map(function(b){return b*i.scale}),2),v=u[0],g=u[1];this.ctx.save(),this.ctx.lineWidth=f||this.lineWidth,this.ctx.fillStyle=s||this.fillStyle,this.ctx.strokeStyle=n||h?this.activeStrokeStyle:e||this.strokeStyle,this.ctx.beginPath(),this.ctx.arc(v,g,o*this.scale,0,2*Math.PI,!0),this.ctx.fill(),this.ctx.arc(v,g,o*this.scale,0,2*Math.PI,!0),this.ctx.stroke(),this.ctx.restore(),this.drawLabel(p[0],t)},a.prototype.drawLine=function(t){var i=this,e=t.strokeStyle,s=t.active,n=t.creating,r=t.coor,h=t.lineWidth;if(this.ctx.save(),this.ctx.lineJoin="round",this.ctx.lineWidth=h||this.lineWidth,this.ctx.strokeStyle=s||n?this.activeStrokeStyle:e||this.strokeStyle,this.ctx.beginPath(),r.forEach(function(u,v){var g=l(u.map(function(S){return Math.round(S*i.scale)}),2),b=g[0],I=g[1];v===0?i.ctx.moveTo(b,I):i.ctx.lineTo(b,I)}),n){var o=l(this.mouse||[],2),p=o[0],f=o[1];this.ctx.lineTo(p-this.originX,f-this.originY)}this.ctx.stroke(),this.ctx.restore(),this.drawLabel(r[0],t)},a.prototype.drawCtrl=function(t){var i=this,e=l(t.map(function(r){return r*i.scale}),2),s=e[0],n=e[1];this.ctx.save(),this.ctx.beginPath(),this.ctx.fillStyle=this.ctrlFillStyle,this.ctx.strokeStyle=this.ctrlStrokeStyle,this.ctx.arc(s,n,this.ctrlRadius,0,2*Math.PI,!0),this.ctx.fill(),this.ctx.arc(s,n,this.ctrlRadius,0,2*Math.PI,!0),this.ctx.stroke(),this.ctx.restore()},a.prototype.drawCtrlList=function(t){var i=this;t.ctrlsData.forEach(function(e,s){t.type===c.Circle?s===1&&i.drawCtrl(e):i.drawCtrl(e)})},a.prototype.drawLabel=function(t,i){var e=this,s=i.label,n=s===void 0?"":s,r=i.labelFillStyle,h=r===void 0?"":r,o=i.labelFont,p=o===void 0?"":o,f=i.textFillStyle,u=f===void 0?"":f,v=i.hideLabel,g=i.labelUp,b=i.lineWidth,I=typeof v=="boolean"?v:this.hideLabel,S=typeof g=="boolean"?g:this.labelUp,E=b||this.lineWidth;if(n.length&&!I){this.ctx.font=p||this.labelFont;var k=n.length<this.labelMaxLen+1?n:"".concat(n.slice(0,this.labelMaxLen),"..."),G=this.ctx.measureText(k),m=parseInt(this.ctx.font)-4,W=G.width+8,D=m+8,y=l(t.map(function(O){return O*e.scale}),2),H=y[0],M=y[1],x=this.IMAGE_ORIGIN_WIDTH-t[0]<W/this.scale,C=this.IMAGE_ORIGIN_HEIGHT-t[1]<D/this.scale,F=t[1]>D/this.scale,P=S?F:C;this.ctx.save(),this.ctx.fillStyle=h||this.labelFillStyle,this.ctx.fillRect(x?H-G.width-4-E/2:H+E/2,P?M-D-E/2:M+E/2,W,D),this.ctx.fillStyle=u||this.textFillStyle,this.ctx.fillText(k,x?H-G.width:H+4+E/2,P?M-D+m+4:M+m+4+E/2,180),this.ctx.restore()}},a.prototype.update=function(){var t=this;window.cancelAnimationFrame(this.timer),this.timer=window.requestAnimationFrame(function(){t.ctx.save(),t.ctx.clearRect(0,0,t.WIDTH,t.HEIGHT),t.ctx.translate(t.originX,t.originY),t.IMAGE_WIDTH&&t.IMAGE_HEIGHT&&t.ctx.drawImage(t.image,0,0,t.IMAGE_WIDTH,t.IMAGE_HEIGHT);for(var i=t.focusMode?t.activeShape.type?[t.activeShape]:[]:t.dataset,e=0;e<i.length;e++){var s=i[e];if(!s.hide)switch(s.type){case c.Rect:t.drawRect(s);break;case c.Polygon:t.drawPolygon(s);break;case c.Dot:t.drawDot(s);break;case c.Line:t.drawLine(s);break;case c.Circle:t.drawCirle(s)}}[c.Rect,c.Polygon,c.Line,c.Circle].includes(t.activeShape.type)&&!t.activeShape.hide&&t.drawCtrlList(t.activeShape),t.ctx.restore(),t.emit("updated",t.dataset)})},a.prototype.deleteByIndex=function(t){var i=this.dataset.findIndex(function(e){return e.index===t});i>-1&&(this.emit("delete",this.dataset[i]),this.dataset.splice(i,1),this.dataset.forEach(function(e,s){e.index=s}),this.update())},a.prototype.calcStep=function(t){t===void 0&&(t=""),this.IMAGE_WIDTH<this.WIDTH&&this.IMAGE_HEIGHT<this.HEIGHT&&(t!==""&&t!=="b"||(this.setScale(!0,!1,!0),this.calcStep("b"))),(this.IMAGE_WIDTH>this.WIDTH||this.IMAGE_HEIGHT>this.HEIGHT)&&(t!==""&&t!=="s"||(this.setScale(!1,!1,!0),this.calcStep("s")))},a.prototype.setScale=function(t,i,e){if(i===void 0&&(i=!1),e===void 0&&(e=!1),!this.lock&&!(!t&&this.imageMin<20||t&&this.IMAGE_WIDTH>100*this.imageOriginMax)){t?this.scaleStep++:this.scaleStep--;var s=0,n=0,r=l(this.mouse||[],2),h=r[0],o=r[1];i&&(s=(h-this.originX)/this.scale,n=(o-this.originY)/this.scale);var p=Math.abs(this.scaleStep),f=this.IMAGE_WIDTH;if(this.IMAGE_WIDTH=Math.round(this.IMAGE_ORIGIN_WIDTH*Math.pow(this.scaleStep>=0?1.05:.95,p)),this.IMAGE_HEIGHT=Math.round(this.IMAGE_ORIGIN_HEIGHT*Math.pow(this.scaleStep>=0?1.05:.95,p)),i)this.originX=h-s*this.scale,this.originY=o-n*this.scale;else{var u=this.IMAGE_WIDTH/f;this.originX=this.WIDTH/2-(this.WIDTH/2-this.originX)*u,this.originY=this.HEIGHT/2-(this.HEIGHT/2-this.originY)*u}e||this.update()}},a.prototype.fitZoom=function(){this.calcStep(),this.IMAGE_HEIGHT/this.IMAGE_WIDTH>=this.HEIGHT/this.WIDTH?(this.IMAGE_WIDTH=this.IMAGE_ORIGIN_WIDTH/(this.IMAGE_ORIGIN_HEIGHT/this.HEIGHT),this.IMAGE_HEIGHT=this.HEIGHT):(this.IMAGE_WIDTH=this.WIDTH,this.IMAGE_HEIGHT=this.IMAGE_ORIGIN_HEIGHT/(this.IMAGE_ORIGIN_WIDTH/this.WIDTH)),this.originX=(this.WIDTH-this.IMAGE_WIDTH)/2,this.originY=(this.HEIGHT-this.IMAGE_HEIGHT)/2,this.update()},a.prototype.setFocusMode=function(t){this.focusMode=t,this.update()},a.prototype.destroy=function(){this.image.removeEventListener("load",this.handleLoad),this.canvas.removeEventListener("contextmenu",this.handleContextmenu),this.canvas.removeEventListener("mousewheel",this.handleMousewheel),this.canvas.removeEventListener("mousedown",this.handleMouseDown),this.canvas.removeEventListener("touchend",this.handleMouseDown),this.canvas.removeEventListener("mousemove",this.handleMouseMove),this.canvas.removeEventListener("touchmove",this.handleMouseMove),this.canvas.removeEventListener("mouseup",this.handleMouseUp),this.canvas.removeEventListener("touchend",this.handleMouseUp),this.canvas.removeEventListener("dblclick",this.handleDblclick),document.body.removeEventListener("keydown",this.handleKeydown,!0),document.body.removeEventListener("keyup",this.handleKeyup,!0),this.canvas.width=this.WIDTH,this.canvas.height=this.HEIGHT,this.canvas.style.width=null,this.canvas.style.height=null,this.canvas.style.userSelect=null},a.prototype.resize=function(){this.canvas.width=null,this.canvas.height=null,this.canvas.style.width=null,this.canvas.style.height=null,this.initSetting(),this.update()},a}(rt);return ct})})(ot);var mt=ot.exports;const bt=ft(mt),Mt=""+new URL("home6-CAyGTXbN.png",import.meta.url).href,Ht={class:"module canvasWrap"},xt=gt('<canvas class="canvasContainer" data-v-6fcb09a7></canvas><div class="info" data-v-6fcb09a7><div class="item" data-v-6fcb09a7><div class="icon1" data-v-6fcb09a7></div><div data-v-6fcb09a7>鹰眼</div></div><div class="item" data-v-6fcb09a7><div class="icon2" data-v-6fcb09a7></div><div data-v-6fcb09a7>球机</div></div><div class="item" data-v-6fcb09a7><div class="icon3" data-v-6fcb09a7></div><div data-v-6fcb09a7>枪机</div></div></div>',2),Et={key:0,src:at,alt:""},Tt={key:1,src:nt,alt:""},_t={key:0,src:nt,alt:""},Gt={key:1,src:at,alt:""},Dt={__name:"Center",setup(q){const N=St(),R=yt(null);let w=null;const L=(_,T,A="")=>({labelFillStyle:"#fff",textFillStyle:"#000",lineWidth:0,fillStyle:"red",strokeStyle:"red",label:A,coor:[[_,T],[_+20,T+15]],labelFont:"16px sans-serif	",active:!1,creating:!1,dragging:!1,index:0,type:1,labelUp:!0}),l=(_,T,A="")=>({labelFont:"16px sans-serif	",labelFillStyle:"#fff",textFillStyle:"#000",fillStyle:"red",strokeStyle:"red",active:!1,creating:!1,dragging:!1,index:0,label:A,coor:[[_,T],[_+15,T+25],[_-15,T+25]],type:2,labelUp:!0}),X=(_,T,A="")=>({labelFont:"16px sans-serif	",labelFillStyle:"#fff",textFillStyle:"#000",fillStyle:"red",strokeStyle:"red",label:A,coor:[_,T],active:!1,creating:!1,dragging:!1,uuid:"3b23cf5e-ac84-4c52-bdf5-4b6bfa13d2df",index:4,radius:11,type:5,labelUp:!0}),c=()=>{if(!document.querySelector(".canvasWrap"))return;R.value.width=document.querySelector(".canvasWrap").clientWidth,R.value.height=document.querySelector(".canvasWrap").clientHeight,w&&w.destroy(),w=new bt(".canvasContainer",Mt),w.readonly=!0;let T=[X(75,750,"移动信号发射塔"),l(80,780),L(1e3,980,"安健环通道"),L(1040,980),L(1e3,1020),L(1040,1020),l(1580,1020),X(1650,1020,"临建办公楼"),X(1590,1120)];w.setData(T),w.update()};return It(()=>{R.value=document.querySelector(".canvasContainer"),c(),new ResizeObserver(()=>{requestAnimationFrame(()=>{c()})}).observe(document.querySelector(".canvasWrap"))}),(_,T)=>(j(),U("div",Ht,[xt,st("div",{class:"left-btn left-close",onClick:T[0]||(T[0]=(...A)=>Y(N).toggleLeft&&Y(N).toggleLeft(...A))},[Y(N).leftClose?(j(),U("img",Tt)):(j(),U("img",Et))]),st("div",{class:"right-btn",onClick:T[1]||(T[1]=(...A)=>Y(N).toggleRight&&Y(N).toggleRight(...A))},[Y(N).rightClose?(j(),U("img",Gt)):(j(),U("img",_t))])]))}},Wt=vt(Dt,[["__scopeId","data-v-6fcb09a7"]]);export{Wt as default};
